
- 1 AI聊天
```
PS E:\RV1106G3\tool\AiChatServer-win-exe-v1.2\main> .\main.exe --access_token="123456"
pydub\utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
Notice: ffmpeg is not installed. torchaudio is used to load audio
If you want to use ffmpeg backend to load audio, please install it by:
        sudo apt install ffmpeg # ubuntu
        # brew install ffmpeg # mac
funasr version: 1.1.12.
2025-07-12 16:52:17,013 - INFO - download models from model hub: ms
2025-07-12 16:52:17,063 - INFO - Loading pretrained params from ./FunAudioLLM/iic/speech_fsmn_vad_zh-cn-16k-common-pytorch\model.pt
2025-07-12 16:52:17,065 - INFO - ckpt: ./FunAudioLLM/iic/speech_fsmn_vad_zh-cn-16k-common-pytorch\model.pt
2025-07-12 16:52:17,071 - INFO - scope_map: ['module.', 'None']
2025-07-12 16:52:17,071 - INFO - excludes: None
2025-07-12 16:52:17,073 - INFO - Loading ckpt: ./FunAudioLLM/iic/speech_fsmn_vad_zh-cn-16k-common-pytorch\model.pt, status: <All keys matched successfully>
funasr version: 1.1.12.
2025-07-12 16:52:17,074 - INFO - download models from model hub: ms
Loading remote code successfully: ./FunAudioLLM/SenseVoice/model.py
2025-07-12 16:52:18,013 - INFO - Loading pretrained params from ./FunAudioLLM/iic/SenseVoiceSmall\model.pt
2025-07-12 16:52:18,017 - INFO - ckpt: ./FunAudioLLM/iic/SenseVoiceSmall\model.pt
2025-07-12 16:52:18,698 - INFO - scope_map: ['module.', 'None']
2025-07-12 16:52:18,698 - INFO - excludes: None
2025-07-12 16:52:18,806 - INFO - Loading ckpt: ./FunAudioLLM/iic/SenseVoiceSmall\model.pt, status: <All keys matched successfully>
2025-07-12 16:52:18,845 - INFO - server listening on 0.0.0.0:8765
2025-07-12 16:52:18,845 - INFO - Server started on 0.0.0.0:8765
```

- 1 main
```bash
[root@root bin]# ./main
opencv-mobile MIPI CSI camera with v4l2 rkaiq
[Warn]  (0.000, +0)      lv_init: Memory integrity checks are enabled via LV_USE_ASSERT_MEM_INTEGRITY which makes LVGL much slower lv_init.c:259
[Warn]  (0.000, +0)      lv_init: Object sanity checks are enabled via LV_USE_ASSERT_OBJ which makes LVGL much slower lv_init.c:263
[Warn]  (0.000, +0)      lv_init: Style sanity checks are enabled that uses more RAM lv_init.c:267
System time has been successfully updated.
[User]  (4271.240, +4271240)     _sys_para_init: Auto NTP time year: 2025, month: 7, day: 12, hour: 16, minute: 51 ui.c:181
[User]  (4271.399, +159)         _sys_para_init: Manual location city: 广州市, adcode: 440100 ui.c:208
[User]  (4271.401, +2)   _sys_para_init: System para init done. ui.c:210
System time has been successfully updated.
[User]  (4272.475, +1074)        _maintimer_cb: Auto NTP time year: 2025, month: 7, day: 12, hour: 16, minute: 51 ui.c:258
[INFO] (16:51:54) StateMachine: State machine created.
[INFO] (16:51:54) Enter: Into startup state.
[2025-07-12 16:51:54] [info] asio async_connect error: system:111 (Connection refused)
[2025-07-12 16:51:54] [info] Error getting remote endpoint: system:107 (Transport endpoint is not connected)
[ERRO] (16:51:54) operator(): ws failed handle.
[2025-07-12 16:51:54] [error] handle_connect error: Underlying Transport Error
[INFO] (16:51:59) Enter: Try to connect to server.
[ERRO] (16:51:59) Enter: Startup failed.
[2025-07-12 16:51:59] [info] asio async_connect error: system:111 (Connection refused)
[2025-07-12 16:51:59] [info] Error getting remote endpoint: system:107 (Transport endpoint is not connected)
[ERRO] (16:51:59) operator(): ws failed handle.
[2025-07-12 16:51:59] [error] handle_connect error: Underlying Transport Error
[INFO] (16:51:59) Exit: Startup exit.
[INFO] (16:51:59) Enter: Into stopping state.
[WARN] (16:51:59) Run: ai chat app run end
[WARN] (16:51:59) ~Application: Application destruct.
[INFO] (16:51:59) operator(): WebSocket client thread ended.
[INFO] (16:51:59) ~StateMachine: State machine destroyed.

```





```bash
#!/bin/sh

# 设置音频配置的函数
set_audio_config() {

    # 设置 ADC HPF CUT-OFF 为 ON，'1' 表示开启高通滤波器截止频率

    amixer -c 0 cset name='ADC HPF Cut-off' 1

    # 设置 ADC-MIC-RIGHT 开关为关闭状态，'1' 在此上下文中表示关闭（mute）

    amixer -c 0 cset name='ADC MIC Right Switch' 1

    # 设置 ADC Digital Left 音量级别 (范围: 0-255)，这里设置为 211

    amixer -c 0 cset name='ADC Digital Left Volume' 211

    # 设置 ADC MIC Left 增益级别 (范围: 0-3)，这里设置为最大增益 3

    amixer -c 0 cset name='ADC MIC Left Gain' 3

    # 设置 ADC ALC Left 自动电平控制音量 (范围: 0-31)，这里设置为 16

    amixer -c 0 cset name='ADC ALC Left Volume' 16

    # 设置扬声器音量 (范围: 0~30)，这里设置为 25

    amixer -c 0 cset name='DAC LINEOUT Volume' 25

}

  

# 加载内核模块的函数

set_insmod() {

    # 给 insmod_ko.sh 和 insmod_wifi.sh 脚本赋予可执行权限

    chmod +x /oem/usr/ko/insmod_ko.sh

    chmod +x /oem/usr/ko/insmod_wifi.sh

    # 执行 insmod_ko.sh 脚本来加载所需的内核模块

    /oem/usr/ko/insmod_ko.sh

}

  

# 根据传入的第一个参数决定执行哪个函数

case $1 in

    start)

        # 如果参数是 'start'，则设置音频配置并加载内核模块

        set_audio_config

        set_insmod

        # WIFI连接

        # 启用 wlan0 网络接口

        ifconfig wlan0 up

        # 创建 wpa_supplicant 的运行目录

        mkdir -p /var/run/wpa_supplicant

        # 在后台启动 wpa_supplicant 服务，使用指定的配置文件和接口

        wpa_supplicant -B -c /etc/wpa_supplicant.conf -i wlan0

        # 建议等待一会，确保 wpa_supplicant 服务已成功启动并连接到无线网络

        sleep 5

        # 使用 udhcpc 动态获取 IP 地址

        udhcpc -i wlan0

        ;;

    *)

        # 如果没有提供参数或提供的参数不是 'start'，则退出脚本

        exit 1

        ;;

esac


```


```
/etc/init.d/S99echo_defconfig start
```

```
[root@root root]# ifconfig
lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:684 errors:0 dropped:0 overruns:0 frame:0
          TX packets:684 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:50508 (49.3 KiB)  TX bytes:50508 (49.3 KiB)

usb0      Link encap:Ethernet  HWaddr AE:61:F5:F7:40:45
          inet addr:172.32.0.93  Bcast:172.32.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:414 errors:0 dropped:108 overruns:0 frame:0
          TX packets:167 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:90297 (88.1 KiB)  TX bytes:34251 (33.4 KiB)

wlan0     Link encap:Ethernet  HWaddr 8C:BD:37:36:50:14
          inet addr:192.168.1.155  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:526 errors:0 dropped:689 overruns:0 frame:0
          TX packets:75 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:135307 (132.1 KiB)  TX bytes:10144 (9.9 KiB)

[root@root root]#

```

- 1 


### 
```
year=2025
month=1
day=1
hour=0
minute=0
brightness=50
sound=50
wifi_connected=false
auto_time=true
auto_location=false
city=东城区
adcode=440100
gaode_api_key=8558b6b18a3ea48825130883e4f52197
AIChat_server_url=192.168.1.155
AIChat_server_port=8765
AIChat_server_token=123456
AIChat_Client_ID=00:11:22:33:44:55
aliyun_api_key=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
AIChat_protocol_version=1
AIChat_sample_rate=16000
AIChat_channels=1
AIChat_frame_duration=40
~

```

### 

```
curl -X POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions \
  -H "Authorization: Bearer <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>" \
  -H "Content-Type: application/json" \
  -d '{"model":"deepseek-v3","messages":[{"role":"user","content":"测试"}]}'

```

```
.\main.exe --access_token="123456"
```






