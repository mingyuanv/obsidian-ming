---
title: 
aliases: 
tags: 
description:
---
[【君正T31开发记录】3.kernel裁剪及交叉编译\_君正t31刷机-CSDN博客](https://blog.csdn.net/qq_42425882/article/details/143661227?spm=1001.2101.3001.6650.4&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ECtr-4-143661227-blog-143644523.235%5Ev43%5Epc_blog_bottom_relevance_base3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ECtr-4-143661227-blog-143644523.235%5Ev43%5Epc_blog_bottom_relevance_base3&utm_relevant_index=8)
# 随记：
<span style="background:#d3f8b6">前边</span>，我们已经完成了<span style="background:#affad1">uboot的编译及烧录，起作用就是初步初始化板载器件，包括CPU及RAM初始化，关watchdog等。</span>主要作用是用来load操作系统，这里就是指load Linux kernel，现在，我们需要配置裁剪自己的Linux kernel到板子上跑起来。

首先了解下内核方面大致需要些什么配置：

支持后续加载的文件系统
<span style="background:#b1ffff">支持硬件</span>，即加载驱动，具体需要驱动的硬件包括：<span style="background:#affad1">uart、flash(SPI)、sensor(mipi取图，IIC配置sensor)、USB有线网卡、mic、喇叭(GPIO)、硬编码器、SD卡</span>
<span style="background:#affad1">软件支持，后期调试需要的core file生成</span>，没有无线网卡，无线相关协议族也暂时不需要加入
暂时先规划这么多，后续根据需求更改


# 一、内核编译

> [!PDF|important] [[T23 BSP开发参考V1.1.pdf#page=14&selection=265,0,269,2&color=important|T23 BSP开发参考V1.1, p.14]]
> > 3.2 Kernel 编译


> [!PDF|important] [[T23 软件资源编译指南.pdf#page=10&selection=36,3,42,5&color=important|T23 软件资源编译指南, p.10]]
> >  编译流程 kernel 可单独编译
> 
> 

## 1.编译流程

<span style="background:#b1ffff">第一步</span>：$make isvp_pike_defconfig <span style="background:#affad1">使用相对配置好的板级文件</span>
<span style="background:#b1ffff">第二步</span>：$ make menuconfig 根据需求选择性编译
<span style="background:#b1ffff">第三步</span>：$ make uImage 编译内核文件
如果报错，执行 $ make distclean ，然后从第一步重新开始


Entry Point:  80386430
<span style="background:#b1ffff">内核镜像位置：</span>Image <span style="background:#affad1">arch/mips/boot/uImage</span>

## 2.报错与解结
 [[编译 Linux 内核时，系统找不到 `gcc`（主机编译器）]]


## 3.注意
之前我们已经在flash中write了uboot，现在我们只需要<span style="background:#affad1">在特定位置写入kernel镜像即可（可以向后多擦除一点flash，只要不破坏前边的uboot）</span>


发现这里一直反复在拉起内核，内核又panic掉，查看打印，是缺少rootfs，这个我们后续再来制作rootfs

# 二、`make menuconfig`图形化配置裁剪

<span style="background:#fdbfff">看csdn有教程</span>

> [!PDF|note] [[T23 BSP开发参考V1.1.pdf#page=15&selection=73,0,83,17&color=note|T23 BSP开发参考V1.1, p.15]]
> > 内核默认的 config 留有一定余量，而实际产品往往需要进行内核裁减以释放更多的空间。以下是<span style="background:#affad1">几个常用可供裁减的选项及说明</span>
> 
> 

> [!PDF|note] [[T23 软件资源编译指南.pdf#page=10&selection=197,0,201,7&color=note|T23 软件资源编译指南, p.10]]
> > 2.2<span style="background:#b1ffff"> Kernel 裁剪选项及说明</span>
> 
> 



## 1.软件依赖

- 根据需求定制内核，首先确定支持的文件系统：squashfs（压缩只读文件系统，用于不修改的系统分区）、jffs2（可选压缩读写文件系统，用于日志等有读写需求的分区）

- 支持ELF即Linux可执行文件，支持core dump生成

## 2.需要的驱动
 - 没有无线网卡，把这个关掉：

- 需要IIC总线驱动

- usb有线以太网卡和SD卡

- 不需要无线协议，关掉

## 3.






# 三、

## 1.



## 2.




## 3.




