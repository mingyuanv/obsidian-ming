从启动日志中的 **MTD 分区信息**和 **文件系统挂载行为**，可以明确以下结论：

---

### **1. MTD 分区布局分析**
日志中显示的 Flash 分区如下（十六进制地址）：
```plaintext
0x000000000000-0x000000040000 : "boot"       // 256KB
0x000000040000-0x0000002c0000 : "kernel"     // 2.5MB (0x040000 ~ 0x2c0000)
0x0000002c0000-0x0000004c0000 : "root"       // 2.0MB (0x2c0000 ~ 0x4c0000)
0x0000004c0000-0x000001000000 : "appfs"      // 11.25MB (0x4c0000 ~ 0x1000000)
```

- **关键分区**：`root` 分区起始地址为 **0x2c0000**，结束地址为 **0x4c0000**，总容量为 **2.0MB**（`0x4c0000 - 0x2c0000 = 0x200000`）。

---

### **2. 为何 `rootfs.squashfs` 必须从 0x2c0000 开始？**
1. **文件系统挂载逻辑**：
   - 内核启动后，尝试挂载 `rootfs.squashfs` 到 MTD 的 `root` 分区（对应地址 `0x2c0000`）。
   - 若 `rootfs.squashfs` 的烧录起始地址低于 `0x2c0000`（如错误烧录到 `kernel` 分区末尾），会导致：
     - **数据覆盖**：覆盖 `kernel` 分区尾部数据，可能破坏内核镜像。
     - **挂载失败**：文件系统元数据与分区不匹配，无法正确识别。

2. **空间不足的后果**：
   - `root` 分区总大小 **2.0MB**（`0x200000`），若 `rootfs.squashfs` 编译后体积超过此限制：
     - **文件丢失**：超出部分会覆盖 `appfs` 分区起始区域（`0x4c0000`），破坏应用存储数据。
     - **系统崩溃**：关键只读文件系统被截断，导致运行时缺失必要文件（如 `/bin/init`）。

---

### **3. 验证结论的日志证据**
- **挂载成功提示**：
  ```plaintext
  [    0.592733] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
  ```
  - 设备 `31:2` 对应 MTD 的 `root` 分区（第3个分区，索引从0开始）。
- **擦除操作位置**：
  ```plaintext
  Erasing 32 Kibyte @ b40000 - 100% complete.
  ```
  - 地址 `0xb40000` 属于 `appfs` 分区（`0x4c0000 ~ 0x1000000`），若 `rootfs.squashfs` 溢出到此处，此区域的擦除会破坏原有数据。

---

### **4. 解决方案**
#### **(1) <span style="background:#b1ffff">确保 `rootfs.squashfs` 编译后体积 ≤ 2.0MB**</span>
- **检查方法**：
  ```bash
  ls -lh rootfs.squashfs  # 查看文件实际大小
  ```
- **优化策略**：
  - 删除无用文件（如调试符号、冗余库）。
  - 使用 `mksquashfs` 高压缩率选项（如 `-comp xz`）。
  - 剥离非必要内核模块或驱动。

#### **(2) 调整 MTD 分区表**
- **修改分区定义**（通常在 Uboot 或内核设备树中）：
  ```dts
  partitions {
      boot: 0x000000-0x040000;      // 保持 256KB
      kernel: 0x040000-0x240000;     // 缩小内核分区（原 2.5MB → 2.0MB）
      root: 0x240000-0x4c0000;       // 扩展 root 分区（2.0MB → 2.8MB）
      appfs: 0x4c0000-0x1000000;     // 剩余空间给 appfs
  };
  ```
- **风险**：需重新验证内核镜像是否适配新分区大小。

#### **(3) 使用 OverlayFS 扩展只读根文件系统**
- **原理**：将 `rootfs.squashfs` 设为只读基础层，`appfs` 分区挂载为可写覆盖层。
- **优势**：避免修改分区表，动态扩展存储需求。

---

### **5. 调试建议**
- **查看 MTD 分区详情**：
  ```bash
  cat /proc/mtd       # 显示分区表
  ```
- **检查 `rootfs.squashfs` 完整性**：
  ```bash
  unsquashfs -l rootfs.squashfs  # 列出文件是否完整
  ```

---

### **总结**
- **根本原因**：<span style="background:#affad1">`rootfs.squashfs` 的烧录位置和大小必须严格匹配 MTD 的 `root` 分区定义（起始 `0x2c0000`，大小 `0x200000`）。</span>
- **优先级**：若无法缩减文件系统体积，优先调整分区表；否则优化文件系统内容。




















