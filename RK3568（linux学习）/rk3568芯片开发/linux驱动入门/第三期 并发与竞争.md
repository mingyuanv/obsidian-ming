---
title: 
aliases: 
tags:
  - 并发与竞争
  - 原子操作、自旋锁、信号量、互斥体
description:
---

# 备注(声明)：



# 一、


## 1.什么是并发与竞争？
[1.什么是并发与竞争？](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#1.什么是并发与竞争？&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={EF7D991A-1F8F-4120-AAF3-6C433F924B9F}&end)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F1.%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89%EF%BC%9F%7CEF7D991A-1F8F-4120-AAF3-6C433F924B9F%2F%29&wdpartid=%7bE6A4DC52-177B-4815-B452-9EBE0C810D5E%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))
### 1.1 Linux在什么情况下会成并发?
[“1.什么是并发与竞争？”页上的图片](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#1.什么是并发与竞争？&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={EF7D991A-1F8F-4120-AAF3-6C433F924B9F}&object-id={D8B0C8EF-A82E-42AB-A869-B8A6D9861F3A}&52)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F1.%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89%EF%BC%9F%7CEF7D991A-1F8F-4120-AAF3-6C433F924B9F%2F%29&wdpartid=%7bE6A4DC52-177B-4815-B452-9EBE0C810D5E%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

### 1.2 发生并发时要保护的共享资源
[“1.什么是并发与竞争？”页上的图片](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#1.什么是并发与竞争？&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={EF7D991A-1F8F-4120-AAF3-6C433F924B9F}&object-id={D8B0C8EF-A82E-42AB-A869-B8A6D9861F3A}&5C)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F1.%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89%EF%BC%9F%7CEF7D991A-1F8F-4120-AAF3-6C433F924B9F%2F%29&wdpartid=%7bE6A4DC52-177B-4815-B452-9EBE0C810D5E%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

某个整形的全局变量，或者驱动中的设备结构体
### 1.3 并发和竞争的处理方法
[“1.什么是并发与竞争？”页上的图片](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#1.什么是并发与竞争？&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={EF7D991A-1F8F-4120-AAF3-6C433F924B9F}&object-id={D8B0C8EF-A82E-42AB-A869-B8A6D9861F3A}&66)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F1.%E4%BB%80%E4%B9%88%E6%98%AF%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89%EF%BC%9F%7CEF7D991A-1F8F-4120-AAF3-6C433F924B9F%2F%29&wdpartid=%7bE6A4DC52-177B-4815-B452-9EBE0C810D5E%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

原子操作、自旋锁、信号量、互斥体



## 2.并发与竞争总结
[“11.并发与竞争总结（同步与互斥）”页上的图片](onenote:#11.并发与竞争总结（同步与互斥）&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={4AA6A284-8F13-45BA-9CE4-C14CDF2FC56B}&object-id={CD35410B-79CB-4DFF-986B-076841B6C321}&2E&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

![RK3568（linux学习）/rk3568芯片开发/linux驱动入门/assets/第三期 并发与竞争/file-20250810171733923.png](assets/第三期%20并发与竞争/file-20250810171733923.png)




# 二、并发与竞争的解决方法



## 1.原子操作
### 1.1 应用对象
[“2.原子操作理论讲解”页上的图片](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#2.原子操作理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={7124D3D1-0347-4365-B24C-AE5AF5FDD596}&object-id={F386A518-430D-441D-89F7-E6E4B8DC0024}&19)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F2.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C7124D3D1-0347-4365-B24C-AE5AF5FDD596%2F%29&wdpartid=%7b69E5443E-804B-4B8D-A232-CF79E97D9FEA%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

<span style="background:#b1ffff">整形变量、位</span>
### 1.2、原子整形变量描述结构体-atomic64_t
[“2.原子操作理论讲解”页上的图片](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#2.原子操作理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={7124D3D1-0347-4365-B24C-AE5AF5FDD596}&object-id={F386A518-430D-441D-89F7-E6E4B8DC0024}&2D)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F2.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C7124D3D1-0347-4365-B24C-AE5AF5FDD596%2F%29&wdpartid=%7b69E5443E-804B-4B8D-A232-CF79E97D9FEA%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

### 1.3 原子整形操作API函数（32位）
[“2.原子操作理论讲解”页上的绘图](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#2.原子操作理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={7124D3D1-0347-4365-B24C-AE5AF5FDD596}&object-id={FDE531DB-1141-43B8-874B-FC91FA0729E2}&48)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F2.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C7124D3D1-0347-4365-B24C-AE5AF5FDD596%2F%29&wdpartid=%7b69E5443E-804B-4B8D-A232-CF79E97D9FEA%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

### 1.4 原子整形操作API函数（64位）
[“2.原子操作理论讲解”页上的图片](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#2.原子操作理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={7124D3D1-0347-4365-B24C-AE5AF5FDD596}&object-id={F386A518-430D-441D-89F7-E6E4B8DC0024}&3C)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F2.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C7124D3D1-0347-4365-B24C-AE5AF5FDD596%2F%29&wdpartid=%7b69E5443E-804B-4B8D-A232-CF79E97D9FEA%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

### 1.5、原子整形操作举例
[“2.原子操作理论讲解”页上的图片](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#2.原子操作理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={7124D3D1-0347-4365-B24C-AE5AF5FDD596}&object-id={F386A518-430D-441D-89F7-E6E4B8DC0024}&45)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F2.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C7124D3D1-0347-4365-B24C-AE5AF5FDD596%2F%29&wdpartid=%7b69E5443E-804B-4B8D-A232-CF79E97D9FEA%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

### 1.6、原子整形操作实验
[3.原子操作实验_基于RK3568](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#3.原子操作实验_基于RK3568&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={4069C601-5FB0-489E-BD50-88B6A77582A3}&end)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F3.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E5%AE%9E%E9%AA%8C_%E5%9F%BA%E4%BA%8ERK3568%7C4069C601-5FB0-489E-BD50-88B6A77582A3%2F%29&wdpartid=%7b064DAC9C-2612-4DEE-903B-CCB6B353111C%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

<span style="background:#affad1">保障整形变量，在同一时间只能被一个应用层程序所调用。</span>

### 1.7、原子位操作API函数
[“2.原子操作理论讲解”页上的图片](onenote:https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#2.原子操作理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={7124D3D1-0347-4365-B24C-AE5AF5FDD596}&object-id={F386A518-430D-441D-89F7-E6E4B8DC0024}&4F)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F2.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C7124D3D1-0347-4365-B24C-AE5AF5FDD596%2F%29&wdpartid=%7b69E5443E-804B-4B8D-A232-CF79E97D9FEA%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))


## 2、自旋锁-原地等待
### 2.1、自旋锁结构体-spinlock_t
[“4.自旋锁理论讲解”页上的图片](onenote:https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#4.自旋锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8}&object-id={2FDA522A-9065-42B4-8FA4-DF0257AB08AD}&2E)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F4.%E8%87%AA%E6%97%8B%E9%94%81%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8%2F%29&wdpartid=%7bF1CE151B-3F59-4CB9-8199-210F3B7CF02C%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

### 2.2 、自旋锁的API函数
[“4.自旋锁理论讲解”页上的图片](onenote:https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#4.自旋锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8}&object-id={2FDA522A-9065-42B4-8FA4-DF0257AB08AD}&3B)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F4.%E8%87%AA%E6%97%8B%E9%94%81%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8%2F%29&wdpartid=%7bF1CE151B-3F59-4CB9-8199-210F3B7CF02C%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

[“4.自旋锁理论讲解”页上的图片](onenote:https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#4.自旋锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8}&object-id={2FDA522A-9065-42B4-8FA4-DF0257AB08AD}&5A)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F4.%E8%87%AA%E6%97%8B%E9%94%81%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8%2F%29&wdpartid=%7bF1CE151B-3F59-4CB9-8199-210F3B7CF02C%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

### 2.4 、使用步骤
[“4.自旋锁理论讲解”页上的图片](onenote:https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#4.自旋锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8}&object-id={2FDA522A-9065-42B4-8FA4-DF0257AB08AD}&44)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F4.%E8%87%AA%E6%97%8B%E9%94%81%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8%2F%29&wdpartid=%7bF1CE151B-3F59-4CB9-8199-210F3B7CF02C%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

### 2.5、注意事项
[“4.自旋锁理论讲解”页上的绘图](onenote:https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one#4.自旋锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8}&object-id={88C51C80-0582-4805-9BDA-6623C1086FF9}&7B)  ([Web 视图](https://onedrive.live.com/view.aspx?resid=52D4B76BB0FFCF51%21se8c325913f784bf694d429e5ee2ab2be&id=documents&wd=target%28%E7%AC%AC%E4%B8%89%E6%9C%9F_%E5%B9%B6%E5%8F%91%E4%B8%8E%E7%AB%9E%E4%BA%89.one%7CF8CA309F-937C-400C-AF48-5926DD1FB57E%2F4.%E8%87%AA%E6%97%8B%E9%94%81%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3%7C9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8%2F%29&wdpartid=%7bF1CE151B-3F59-4CB9-8199-210F3B7CF02C%7d%7b1%7d&wdsectionfileid=52D4B76BB0FFCF51!sd31d3d60d96149cfaaa8c6a88b868782))

### 2.6、自旋锁实验
[枷锁和解锁中间的这个区域](onenote:#4.自旋锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={9C53FC41-3BDC-4A93-BD2A-EFB4B94775A8}&object-id={3EAA28FF-8AF5-4F24-815D-F59E3D8D32A0}&5C&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

[5.自旋锁实验_基于RK3568](onenote:#5.自旋锁实验_基于RK3568&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={84F6AEC2-8F23-422D-8832-BA2A40BB6ADE}&end&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

## 3.自旋锁的死锁
### 3.1 理论讲解
[“6.自旋锁的死锁”页上的图片](onenote:#6.自旋锁的死锁&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={67CA5D7F-23E2-4CED-AF9C-FDC8FFFB91AD}&object-id={184B886B-5DBF-4DDE-A648-D531E60AA64D}&20&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

### 3.2 使用情境：单核单线程的cpu-虚拟机ubuntu

[“6.自旋锁的死锁”页上的图片](onenote:#6.自旋锁的死锁&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={67CA5D7F-23E2-4CED-AF9C-FDC8FFFB91AD}&object-id={184B886B-5DBF-4DDE-A648-D531E60AA64D}&40&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

### 3.3 实验现象

[死锁呢就让我的这个虚拟机崩溃了](onenote:#6.自旋锁的死锁&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={67CA5D7F-23E2-4CED-AF9C-FDC8FFFB91AD}&object-id={5C823A0D-8349-43C4-9626-F50460775BAB}&A9&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

### 3.4 如何避免死锁

[“6.自旋锁的死锁”页上的图片](onenote:#6.自旋锁的死锁&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={67CA5D7F-23E2-4CED-AF9C-FDC8FFFB91AD}&object-id={184B886B-5DBF-4DDE-A648-D531E60AA64D}&CD&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)


## 4、信号量

### 应用场景
[“7.信号量理论讲解”页上的图片](onenote:#7.信号量理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={2EC2C678-CB42-4353-9319-B4EC3C6A9BF7}&object-id={5BEBB10B-C625-423D-BED2-2CDA151223BE}&12&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)


### 工作原理
[“7.信号量理论讲解”页上的图片](onenote:#7.信号量理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={2EC2C678-CB42-4353-9319-B4EC3C6A9BF7}&object-id={5BEBB10B-C625-423D-BED2-2CDA151223BE}&2C&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)


### 结构体-semaphore

[“7.信号量理论讲解”页上的图片](onenote:#7.信号量理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={2EC2C678-CB42-4353-9319-B4EC3C6A9BF7}&object-id={5BEBB10B-C625-423D-BED2-2CDA151223BE}&32&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)


### 信号量的API函数
[“7.信号量理论讲解”页上的绘图](onenote:#7.信号量理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={2EC2C678-CB42-4353-9319-B4EC3C6A9BF7}&object-id={540EECCC-DF6B-4BB1-831B-0526B277AFFE}&26&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)


### 注意事项
[“7.信号量理论讲解”页上的图片](onenote:#7.信号量理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={2EC2C678-CB42-4353-9319-B4EC3C6A9BF7}&object-id={DA184F97-1B98-4068-BE02-23B36844B987}&14&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

### 驱动代码编写
[这样我们使用信号量来让我们这个驱动啊](onenote:#7.信号量理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={2EC2C678-CB42-4353-9319-B4EC3C6A9BF7}&object-id={DA184F97-1B98-4068-BE02-23B36844B987}&6D&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)
[同时只能被一个应用程序打开](onenote:#7.信号量理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={2EC2C678-CB42-4353-9319-B4EC3C6A9BF7}&object-id={DA184F97-1B98-4068-BE02-23B36844B987}&6F&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)


### 实验现象
[8.信号量实验_基于RK3568](onenote:#8.信号量实验_基于RK3568&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={D7E4D978-78B0-413F-A89C-E8DA5D401C40}&end&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

### 



## 5、互斥锁

### 应用场景
[利用互斥锁可以实现一个驱动，在同一时刻只能被一个进程调用，让另一个调用的进程进入失眠](onenote:#9.互斥锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={3502BA7E-E51C-48D8-97E4-28206950090F}&object-id={FC51EBDA-EC8A-4E4A-889B-5FC726FF05B5}&1C&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

### 描达互斥锁：结构体-mutex
[“9.互斥锁理论讲解”页上的图片](onenote:#9.互斥锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={3502BA7E-E51C-48D8-97E4-28206950090F}&object-id={1566273E-F135-4DC7-824F-7E7E1655F86E}&27&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

### 互斥锁的API函数

[“9.互斥锁理论讲解”页上的图片](onenote:#9.互斥锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={3502BA7E-E51C-48D8-97E4-28206950090F}&object-id={1566273E-F135-4DC7-824F-7E7E1655F86E}&30&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)
### 注意事项
[“9.互斥锁理论讲解”页上的图片](onenote:#9.互斥锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={3502BA7E-E51C-48D8-97E4-28206950090F}&object-id={1566273E-F135-4DC7-824F-7E7E1655F86E}&39&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

###  驱动代码编写
[“9.互斥锁理论讲解”页上的图片](onenote:#9.互斥锁理论讲解&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={3502BA7E-E51C-48D8-97E4-28206950090F}&object-id={1566273E-F135-4DC7-824F-7E7E1655F86E}&42&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)

### 实验现象
[10.互斥锁实验_基于RK3568](onenote:#10.互斥锁实验_基于RK3568&section-id={F8CA309F-937C-400C-AF48-5926DD1FB57E}&page-id={2D7BFEF2-CE50-4A52-8833-69EF1361AC8B}&end&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第三期_并发与竞争.one)


### 

# 三、使用场景划分


## 1.需要用互斥锁或者是用信号量的情景
我们<span style="background:#affad1">一般优先考虑互斥锁</span>
再考虑信号量

只有在那些<span style="background:#d3f8b6">特别特别底层的代码中</span>
你<span style="background:#d3f8b6">才需要优先去考虑这个信号量</span>

## 2.原子操作
比如说我就要<span style="background:#d3f8b6">简单的保护一下</span>
<span style="background:#d3f8b6">我的全局变量</span>

## 3.自旋锁
如果说啊你的这个<span style="background:#d3f8b6">持有所的时间很短</span>
<span style="background:#d3f8b6">保护的这个临界区很小</span>


## 4、信号量
如果说你要<span style="background:#affad1">对多个资源进行保护</span>
<span style="background:#affad1">而且持有所的时间很长</span>


## 5、互斥体
如果说你就要<span style="background:#affad1">保护啊一个这个资源</span>
<span style="background:#affad1">而且呢这个持有所的时间也很长</span>

