---
title: 
aliases: 
tags: 
description:
---

# 备注(声明)：
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十期 热插拔/file-20250810171745867.png](assets/第十期%20热插拔/file-20250810171745867.png)



# 一、理论知识讲解

## 热插拔概念介绍
### 1 什么是热插拔
[“1.热插拔概念介绍”页上的图片](onenote:#1.热插拔概念介绍&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={1FDA88E9-8603-4664-B48E-3B018C0B1FAA}&object-id={7C75F262-421F-0E44-236F-5E8AB6BB61B9}&14&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 2 热插拔机制-mdev(uevent_helper机制)
[“1.热插拔概念介绍”页上的图片](onenote:#1.热插拔概念介绍&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={1FDA88E9-8603-4664-B48E-3B018C0B1FAA}&object-id={7C75F262-421F-0E44-236F-5E8AB6BB61B9}&29&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)


### 3 热插拔机制-udev(netlink机制)
[“1.热插拔概念介绍”页上的图片](onenote:#1.热插拔概念介绍&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={1FDA88E9-8603-4664-B48E-3B018C0B1FAA}&object-id={7C75F262-421F-0E44-236F-5E8AB6BB61B9}&29&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)


### 4 



## 通过netlink监听广播信息

### 1 netlink机制介绍
[“5.通过netlink监听广播信息”页上的图片](onenote:#5.通过netlink监听广播信息&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={D055C42A-F6A8-4087-91CE-37AEA152D93F}&object-id={CE927229-A975-0F7F-1ACF-32838B7B5BD3}&19&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 2 netlink的使用-socket接口的使用
[“5.通过netlink监听广播信息”页上的图片](onenote:#5.通过netlink监听广播信息&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={D055C42A-F6A8-4087-91CE-37AEA152D93F}&object-id={CE927229-A975-0F7F-1ACF-32838B7B5BD3}&2F&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 3 实验操作及现象
[“5.通过netlink监听广播信息”页上的图片](onenote:#5.通过netlink监听广播信息&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={D055C42A-F6A8-4087-91CE-37AEA152D93F}&object-id={CE927229-A975-0F7F-1ACF-32838B7B5BD3}&8C&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 4 

## 设置uevent_helper来支持mdev

### 1 设置支持 mdev的 方法 1：
[“6.设置uevent_helper”页上的图片](onenote:#6.设置uevent_helper&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={6712504C-E270-4CC8-88F9-9DF3203271E5}&object-id={E9B94C09-F122-0ED1-322D-75E46E93003E}&26&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

- 1 但是方法二和方法三它是依赖于这里面的配置234
### 2 设置支持 mdev的 方法 2：
[“6.设置uevent_helper”页上的图片](onenote:#6.设置uevent_helper&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={6712504C-E270-4CC8-88F9-9DF3203271E5}&object-id={EC0F433A-ECDD-05B1-173E-B20F73DAE680}&33&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 3 设置支持 mdev的 方法 3：
[“6.设置uevent_helper”页上的图片](onenote:#6.设置uevent_helper&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={6712504C-E270-4CC8-88F9-9DF3203271E5}&object-id={EC0F433A-ECDD-05B1-173E-B20F73DAE680}&33&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)


### 4 都是对 uevent_helper 进行读写呢?--代码跟踪分析
[“6.设置uevent_helper”页上的图片](onenote:#6.设置uevent_helper&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={6712504C-E270-4CC8-88F9-9DF3203271E5}&object-id={EC0F433A-ECDD-05B1-173E-B20F73DAE680}&C0&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)


### 5、


# 二、基础实验
## 内核发送事件到用户空间

### 1 函数-发送uevent
[“2.内核是如何发送事件到用户空间的？”页上的图片](onenote:#2.内核是如何发送事件到用户空间的？&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={AE9D63D5-FF30-49C2-B57D-91E2831CDEB7}&object-id={690D6B63-D1FE-088D-1493-48891DCE708C}&14&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 2 action参数
[“2.内核是如何发送事件到用户空间的？”页上的图片](onenote:#2.内核是如何发送事件到用户空间的？&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={AE9D63D5-FF30-49C2-B57D-91E2831CDEB7}&object-id={690D6B63-D1FE-088D-1493-48891DCE708C}&32&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 3 udevadm命令
[“2.内核是如何发送事件到用户空间的？”页上的图片](onenote:#2.内核是如何发送事件到用户空间的？&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={AE9D63D5-FF30-49C2-B57D-91E2831CDEB7}&object-id={690D6B63-D1FE-088D-1493-48891DCE708C}&3D&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 4 代码编写
[#include <linux/module.h>    // 包含用于定义模块初始化和退出函数的宏](onenote:#2.内核是如何发送事件到用户空间的？&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={AE9D63D5-FF30-49C2-B57D-91E2831CDEB7}&object-id={690D6B63-D1FE-088D-1493-48891DCE708C}&82&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 5、实验操作及现象
[“2.内核是如何发送事件到用户空间的？”页上的图片](onenote:#2.内核是如何发送事件到用户空间的？&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={AE9D63D5-FF30-49C2-B57D-91E2831CDEB7}&object-id={690D6B63-D1FE-088D-1493-48891DCE708C}&78&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 6、




## 完善kset_uevent_ops结构体
### 1 kset_uevent_ops结构体。
[// 初始化一个包含上述三个回调函数的kset_uevent_ops结构体。](onenote:#4.完善kset_uevent_ops结构体&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={4ADEE6D9-5D9E-424F-8E3C-1D3E310A3255}&object-id={ABCC100D-28F3-0310-3C3E-CE6CF55245F6}&8E&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 2 三个回调函数的实现
[* @brief 定义一个回调函数，返回kset的名称。](onenote:#4.完善kset_uevent_ops结构体&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={4ADEE6D9-5D9E-424F-8E3C-1D3E310A3255}&object-id={ABCC100D-28F3-0310-3C3E-CE6CF55245F6}&4C&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 3 实验操作及现象
[“4.完善kset_uevent_ops结构体”页上的图片](onenote:#4.完善kset_uevent_ops结构体&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={4ADEE6D9-5D9E-424F-8E3C-1D3E310A3255}&object-id={ABCC100D-28F3-0310-3C3E-CE6CF55245F6}&17&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 4 




## 通过uevent_helper处理uevent事件（mdev）

### 1 需要注意的点:
[“7.通过uevent_helper处理uevent事件”页上的图片](onenote:#7.通过uevent_helper处理uevent事件&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={5F1D4DCB-E0A3-4ABC-805F-967FCCE5E130}&object-id={16553181-0F6D-01DC-222B-DBA459FC2466}&33&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 2、mdev应用程序的编写(mdev.c)
[// 这个操作会使得后续对标准输出的所有写入都被导向到 "/dev/ttyFIQ0"。](onenote:#7.通过uevent_helper处理uevent事件&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={5F1D4DCB-E0A3-4ABC-805F-967FCCE5E130}&object-id={16553181-0F6D-01DC-222B-DBA459FC2466}&A8&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)


### uevent_helper的使用方法
[然后将它的路径写到这个属性文件中](onenote:#7.通过uevent_helper处理uevent事件&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={5F1D4DCB-E0A3-4ABC-805F-967FCCE5E130}&object-id={16553181-0F6D-01DC-222B-DBA459FC2466}&6A&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)
[这样他就会去调用这个路径下的md e v](onenote:#7.通过uevent_helper处理uevent事件&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={5F1D4DCB-E0A3-4ABC-805F-967FCCE5E130}&object-id={16553181-0F6D-01DC-222B-DBA459FC2466}&6C&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

- 1 echo /test/81/mdev > /sys/kernel/uevent_helper

### 3、 实验操作及现象
[“7.通过uevent_helper处理uevent事件”页上的图片](onenote:#7.通过uevent_helper处理uevent事件&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={5F1D4DCB-E0A3-4ABC-805F-967FCCE5E130}&object-id={16553181-0F6D-01DC-222B-DBA459FC2466}&5C&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

- 1 实际上也就是我们实际在项目中用的这个u d e v和md e v这两个可执行程序，它的复杂度要远远高于我们写的啊

### 3 uevent_helper简介
- 1 是 <span style="background:#affad1">Linux 内核中的一个参数</span>，它用于<span style="background:#affad1">指定用户空间程序的路径</span>，<span style="background:#b1ffff">该程序会在内核生成（uevent） 事件时被调用</span>。Uevents 是内核用来通知用户空间设备状态变化的一种机制，例如设备的添加、移除等

- 1 - **热插拔设备支持**：在具有热插拔功能的系统中（如 USB 设备），`uevent_helper` 可以用于自动化地加载驱动程序、挂载文件系统或执行其他必要的操作。




# 三、理论分析讲解
## 内核发送uevent的俩种方法和课后作业讲解（待办-代码流程分析）
[3.内核发送uevent的俩种方法和课后作业讲解](onenote:#3.内核发送uevent的俩种方法和课后作业讲解&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={635B2C69-C5AA-4802-95D6-88051E8F8929}&end&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、










# 四、实践

## 实践-使用udev实现U盘自动挂载
### 1 配置 buildroot 文件系统支持 udev
[“8.实践-使用udev实现U盘自动挂载”页上的图片](onenote:#8.实践-使用udev实现U盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={D08BC2F3-E363-4602-A39D-4BB1E5AF172B}&object-id={4A2D2B0C-25D3-0E6C-1ED0-BBEAC7AA63B0}&14&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

- 1 那实际上它就相当于我们之前说的这个死循环，一直在监听着内核发送的uevent事件

### 2 创建配置规则
[“8.实践-使用udev实现U盘自动挂载”页上的图片](onenote:#8.实践-使用udev实现U盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={D08BC2F3-E363-4602-A39D-4BB1E5AF172B}&object-id={E6F4ACB0-7C27-04DD-34C2-8C5E2FB604B3}&27&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)


- 1 /etc/udev/rules.d/001.rules
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十期 热插拔/file-20250810171746098.sh](assets/第十期%20热插拔/file-20250810171746098.sh)
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十期 热插拔/file-20250810171746165.sh](assets/第十期%20热插拔/file-20250810171746165.sh)
### 3 实验操作和现象

[“8.实践-使用udev实现U盘自动挂载”页上的图片](onenote:#8.实践-使用udev实现U盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={D08BC2F3-E363-4602-A39D-4BB1E5AF172B}&object-id={5BCEFB11-E048-0B88-3EA0-ABF35126070F}&3A&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 4 




## 实践-使用udev实现TF卡自动挂载

### 1 引入-去除自动TF卡挂载
[“9.实践-使用udev实现TF盘自动挂载”页上的图片](onenote:#9.实践-使用udev实现TF盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={D723E036-9923-4EF1-A45C-2091C7824BAD}&object-id={AAFDDC0E-5B2E-0F53-2DE7-B1C733A8EB90}&19&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)


### 2 创建配置规则
- 1 /etc/udev/rules.d/001.rules  -创建文件
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十期 热插拔/file-20250810171746921.sh](assets/第十期%20热插拔/file-20250810171746921.sh)
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十期 热插拔/file-20250810171746973.sh](assets/第十期%20热插拔/file-20250810171746973.sh)


### 3 实验操作和现象
[“9.实践-使用udev实现TF盘自动挂载”页上的图片](onenote:#9.实践-使用udev实现TF盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={D723E036-9923-4EF1-A45C-2091C7824BAD}&object-id={B32C3CB2-67CA-0298-2205-A17DA6487B4E}&3D&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 4 




## 实践-使用mdev实现U盘自动挂载
### 1 配置支持 mdev
[“10.实践-使用mdev实现U盘自动挂载”页上的图片](onenote:#10.实践-使用mdev实现U盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={8F282F70-62B2-4C9D-8F7F-E04947B2F379}&object-id={6B7BB4D5-B5D2-01FC-1E03-3D78F7A5D9C5}&14&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 2 设置 mdev 规则
[“10.实践-使用mdev实现U盘自动挂载”页上的图片](onenote:#10.实践-使用mdev实现U盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={8F282F70-62B2-4C9D-8F7F-E04947B2F379}&object-id={6B7BB4D5-B5D2-01FC-1E03-3D78F7A5D9C5}&26&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

- 1 /etc/mdev.conf  --添加规则
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十期 热插拔/file-20250810171748267.sh](assets/第十期%20热插拔/file-20250810171748267.sh)
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十期 热插拔/file-20250810171748320.sh](assets/第十期%20热插拔/file-20250810171748320.sh)

### 3 迅为的buildroot文件系统密码
[“10.实践-使用mdev实现U盘自动挂载”页上的图片](onenote:#10.实践-使用mdev实现U盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={8F282F70-62B2-4C9D-8F7F-E04947B2F379}&object-id={62494A80-591B-01DF-2398-6029DDEF41E3}&12&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 4 实验操作和现象
[“10.实践-使用mdev实现U盘自动挂载”页上的图片](onenote:#10.实践-使用mdev实现U盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={8F282F70-62B2-4C9D-8F7F-E04947B2F379}&object-id={62494A80-591B-01DF-2398-6029DDEF41E3}&2B&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 5、



## 实践-使用mdev实现TF盘自动挂载
### 1 设置 mdev 规则
[“11.实践-使用mdev实现TF盘自动挂载”页上的图片](onenote:#11.实践-使用mdev实现TF盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={E08512F7-5E08-4E8B-929D-72598ECDEE0F}&object-id={6C98D941-E058-0016-3713-9CD970B0B318}&14&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)


- 1 /etc/mdev.conf  --添加规则
- 1 改完了以后，大家一定要记得重启一下，不然的话这个配置文件是不生效的

### 2 实验操作和现象
[“11.实践-使用mdev实现TF盘自动挂载”页上的图片](onenote:#11.实践-使用mdev实现TF盘自动挂载&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={E08512F7-5E08-4E8B-929D-72598ECDEE0F}&object-id={6C98D941-E058-0016-3713-9CD970B0B318}&3E&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

- 1 echo "/sbin/mdev" > /proc/sys/kernel/hotplug
### 3 




## 提高效率-使用usbmount+udev

### 1 usbmount介绍
[“12.提高效率-使用usbmount+udev”页上的图片](onenote:#12.提高效率-使用usbmount+udev&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={A2BCDF97-752C-4E6E-8CB8-2A7EC0FBEDDE}&object-id={D2450552-6DFC-073A-2EC3-F42E22CE693F}&14&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

### 2 文件系统配置支持usbmount
[“12.提高效率-使用usbmount+udev”页上的图片](onenote:#12.提高效率-使用usbmount+udev&section-id={5AD2192C-ABA8-4064-830A-EA2F52F2F837}&page-id={A2BCDF97-752C-4E6E-8CB8-2A7EC0FBEDDE}&object-id={D4919903-67E4-00BC-36C4-6CB66A1AAF34}&22&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十期_热插拔.one)

- 1 make menuconfig

### 3 
