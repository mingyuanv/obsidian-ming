---
title: 
aliases: 
tags: 
description:
---

# 备注(声明)：
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十三期 输入子系统/file-20250810171749278.png](assets/第十三期%20输入子系统/file-20250810171749278.png)
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十三期 输入子系统/file-20250810171749594.png](assets/第十三期%20输入子系统/file-20250810171749594.png)


# 一、基础理论知识

## 输入子系统介绍
### 1 什么是输入设备?
[“2.输入子系统介绍”页上的图片](onenote:#2.输入子系统介绍&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={3B6E1CC5-2158-4AF4-8949-00841CCA412A}&object-id={96E3BF35-86C0-494E-A121-49A6BB9BDE08}&12&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 2 编写输入设备驱动共同点（框架）
[“2.输入子系统介绍”页上的图片](onenote:#2.输入子系统介绍&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={3B6E1CC5-2158-4AF4-8949-00841CCA412A}&object-id={96E3BF35-86C0-494E-A121-49A6BB9BDE08}&12&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

- 1 这些通用的代码就形成了input子系统

### 3 再次总结input 子系统的作用
[“2.输入子系统介绍”页上的图片](onenote:#2.输入子系统介绍&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={3B6E1CC5-2158-4AF4-8949-00841CCA412A}&object-id={96E3BF35-86C0-494E-A121-49A6BB9BDE08}&1B&base-path=https://d.docs.live.net/52D4B76BB0FFCF51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

- 1 /dev/input/
### 4 

 


## 确定输入设备与节点的对应关系

### 1 不同设备名的含义
[“3.确定输入设备与节点的对应关系”页上的图片](onenote:#3.确定输入设备与节点的对应关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={65C90A61-78C4-445A-9D78-9827EDCD62AC}&object-id={DB7585EF-4DED-4EE5-A424-88104F48BFD9}&31&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

- 1 /dev/input/
### 2 判断哪个节点对应哪个没备(cat)--试探法
[“3.确定输入设备与节点的对应关系”页上的图片](onenote:#3.确定输入设备与节点的对应关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={65C90A61-78C4-445A-9D78-9827EDCD62AC}&object-id={DB7585EF-4DED-4EE5-A424-88104F48BFD9}&45&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 3 hexdump命令简介--试探法
[如果说你不加参数](onenote:#3.确定输入设备与节点的对应关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={65C90A61-78C4-445A-9D78-9827EDCD62AC}&object-id={DB7585EF-4DED-4EE5-A424-88104F48BFD9}&CA&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 4 查看输入设备信息方法--cat /proc/bus/input/devices
[“3.确定输入设备与节点的对应关系”页上的图片](onenote:#3.确定输入设备与节点的对应关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={65C90A61-78C4-445A-9D78-9827EDCD62AC}&object-id={DB7585EF-4DED-4EE5-A424-88104F48BFD9}&76&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)


- 1 试探法和这个方法，这两种方法我们常常结合来使用
### 5、鼠标属性含义
[“3.确定输入设备与节点的对应关系”页上的图片](onenote:#3.确定输入设备与节点的对应关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={65C90A61-78C4-445A-9D78-9827EDCD62AC}&object-id={DB7585EF-4DED-4EE5-A424-88104F48BFD9}&96&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 6、键盘属性文件含义
[“3.确定输入设备与节点的对应关系”页上的图片](onenote:#3.确定输入设备与节点的对应关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={65C90A61-78C4-445A-9D78-9827EDCD62AC}&object-id={DB7585EF-4DED-4EE5-A424-88104F48BFD9}&9C&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

- 1 然后通过这种方法，我们可以详细了解输入设备信息
### 7、实践操作及结果
[“4.实践：确定输入设备对应的设备节点”页上的图片](onenote:#4.实践：确定输入设备对应的设备节点&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={5A59DC4F-89D6-4159-BBCD-C266EB529B38}&object-id={20678F13-E88B-40E4-87EE-E7B9756C39D5}&E&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)


### 8、课后作业讲解--确定虚拟机 ubuntu 中，自己电脑的鼠标键盘对应的设备节点。



## 输入子系统框架

### 1 Input 子系统框架图:
![RK3568（linux学习）/rk3568芯片开发/linux外设驱动开发（未）/assets/第十三期 输入子系统/file-20250810171749780.png](assets/第十三期%20输入子系统/file-20250810171749780.png)

> [!note] 事件处理层
> 事件处理层中的代码，我们是<span style="background:#affad1">不需要编写</span>呀。
><span style="background:#d3f8b6"> 除非特殊情况，要固定设备节点</span>。

> [!note] 设备驱动层
> 这个其实我们直接看就看出来了，他是不是<span style="background:#affad1">直接和硬件打交道呀，他肯定要初始化硬件</span>。

> [!note] 核心层
> 核心层我们也可以把它叫做<span style="background:#affad1">大管家。</span>
> 他<span style="background:#d3f8b6">会将事件处理层中的这个代码</span><span style="background:#d3f8b6"> 和设备驱动层中的这个代码进行匹配。</span>
> 那这样你在交数据的时候
> 你是不是就不会交错了呀。

- 1 只需要写设备驱动层!


## 事件通用层分析


### 1 事件通用层代码evdev.c位置
[“6.输入子系统框架分析”页上的图片](onenote:#6.输入子系统框架分析&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={D92198F3-5D45-43AE-9FEE-7571E0C98000}&object-id={78CC2AA6-7634-4344-AD1B-03B9B14E9EBA}&18&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 2 evdev 设备注册流程:
[那匹配成功之后](onenote:#6.输入子系统框架分析&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={D92198F3-5D45-43AE-9FEE-7571E0C98000}&object-id={78CC2AA6-7634-4344-AD1B-03B9B14E9EBA}&94&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)
[他们就要调用connect函数](onenote:#6.输入子系统框架分析&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={D92198F3-5D45-43AE-9FEE-7571E0C98000}&object-id={78CC2AA6-7634-4344-AD1B-03B9B14E9EBA}&96&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)


- 1 调用input_register_handler函数,注册 input_handler结构体

### 3 结构体定义struct input_handler
[“6.输入子系统框架分析”页上的图片](onenote:#6.输入子系统框架分析&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={D92198F3-5D45-43AE-9FEE-7571E0C98000}&object-id={78CC2AA6-7634-4344-AD1B-03B9B14E9EBA}&49&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)


## 输入子系统关键数据结构之间关系--跟踪代码分析（未）

### 1 引入:input_handle结构体
[“7.输入子系统关键数据结构之间关系”页上的图片](onenote:#7.输入子系统关键数据结构之间关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={8B6F20CB-A7A4-496D-A3B7-24CAEFE33F91}&object-id={A2F2F267-54FA-46E6-B000-76F036CE3693}&1B&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 2 在调用 connect 函数之后
[“7.输入子系统关键数据结构之间关系”页上的图片](onenote:#7.输入子系统关键数据结构之间关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={8B6F20CB-A7A4-496D-A3B7-24CAEFE33F91}&object-id={A2F2F267-54FA-46E6-B000-76F036CE3693}&25&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)


- 1 将input_handler和input_dev 建立连系

### 3 调用 connect 函数之前
[“7.输入子系统关键数据结构之间关系”页上的图片](onenote:#7.输入子系统关键数据结构之间关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={8B6F20CB-A7A4-496D-A3B7-24CAEFE33F91}&object-id={A2F2F267-54FA-46E6-B000-76F036CE3693}&61&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

- 1 在input handler结构体有有俩个链表节点
### 4 关系图
[“7.输入子系统关键数据结构之间关系”页上的图片](onenote:#7.输入子系统关键数据结构之间关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={8B6F20CB-A7A4-496D-A3B7-24CAEFE33F91}&object-id={A2F2F267-54FA-46E6-B000-76F036CE3693}&99&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

- 1 通过链表节点的操作，将input dev和input handler建立起关系

- 1 通过循环遍历链表，那他是不是就可以找到与之匹配的，input dev或者input handler
### 5、



##  认识输入子系统源码以及裁剪
### 1 input 子系统源码所在内核源码路径


### 2 源码文件作用解析
[“8.认识输入子系统源码以及裁剪”页上的图片](onenote:#8.认识输入子系统源码以及裁剪&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={9B59BB07-FA02-41B6-A479-5F4B866E82C2}&object-id={75A2F610-9228-4325-8A98-18CF0DA5AEC9}&30&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

[在这个目录下呢](onenote:#8.认识输入子系统源码以及裁剪&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={9B59BB07-FA02-41B6-A479-5F4B866E82C2}&object-id={84666D4E-F160-4B5D-964A-886E806ABE5F}&6E&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)
### 3 区分这些源码文件是属于那一层的方法
[注册了一个input handler](onenote:#8.认识输入子系统源码以及裁剪&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={9B59BB07-FA02-41B6-A479-5F4B866E82C2}&object-id={84666D4E-F160-4B5D-964A-886E806ABE5F}&52&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)，[是不是事件处理层中的数据结构呢](onenote:#8.认识输入子系统源码以及裁剪&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={9B59BB07-FA02-41B6-A479-5F4B866E82C2}&object-id={84666D4E-F160-4B5D-964A-886E806ABE5F}&56&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 4 如何裁剪这部分的代码--内核make menuconfig
[“8.认识输入子系统源码以及裁剪”页上的图片](onenote:#8.认识输入子系统源码以及裁剪&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={9B59BB07-FA02-41B6-A479-5F4B866E82C2}&object-id={75A2F610-9228-4325-8A98-18CF0DA5AEC9}&94&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 5、


## 通过最简单设备驱动代码分析匹配规则和流程--跟踪代码分析（未）

### 1 函数的调用关系
[input_register_device](onenote:#10.通过最简单设备驱动代码分析匹配规则和流程&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={A965558D-CB73-45BF-9A21-7B390E6291C9}&object-id={D4D900AA-FFC8-4CF6-BDA9-8679511479A4}&C5&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 2 



## 引入多对多的匹配关系--跟踪代码分析（未）
### 1 结论--input_handler和linput_device 是多对多的关系
[“11.引入多对多的匹配关系”页上的图片](onenote:#11.引入多对多的匹配关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={5053D6F5-C4A8-4662-94BB-499B37EFC2D8}&object-id={DC5AD76E-A2E4-4038-A95F-FAC78DACE7B8}&79&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)


> [!note] 最简单的设备驱动层代码
> 我们写的最简单的设备驱动层代码
> <span style="background:#affad1">它匹配了好几个handler</span>
> <span style="background:#d3f8b6">但是设备节点只有一个。</span>
> 
> 那有的时候呢<span style="background:#affad1">这个设备节点他有没有去创建</span>，<span style="background:#affad1">你要去看这个connect的函数里</span>


[我们再总结一下](onenote:#11.引入多对多的匹配关系&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={5053D6F5-C4A8-4662-94BB-499B37EFC2D8}&object-id={64F2E851-495A-4AFC-B00C-20823A914DE8}&AB&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 继续编写设备驱动层代码（理论指导）
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、







# 二、实验

## 最简单的设备驱动层代码
[[输入子系统--注册一个输入设备.canvas|设备驱动层--注册一个输入设备]]

### 1 创建 input_dev结构体变量
[创建 input_dev结构体变量，](onenote:#9.最简单的设备驱动层代码&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={28140FE9-6433-42C1-AF3E-BC4095AA19FA}&object-id={4B9976B7-5A6B-0AAC-2C5B-FA7A358559F5}&1A&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 2 初始化 input_dev 结构体变量--设置事件类型
[初始化 input_dev 结构体变量--设置事件类型](onenote:#9.最简单的设备驱动层代码&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={28140FE9-6433-42C1-AF3E-BC4095AA19FA}&object-id={4B9976B7-5A6B-0AAC-2C5B-FA7A358559F5}&2A&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 3、初始化 input_dev 结构体变量--设置具体类型
[初始化 input_dev 结构体变量--设置具体类型](onenote:#9.最简单的设备驱动层代码&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={28140FE9-6433-42C1-AF3E-BC4095AA19FA}&object-id={4B9976B7-5A6B-0AAC-2C5B-FA7A358559F5}&41&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 4、注册input_dev结构体变量
[注册input_dev结构体变量，](onenote:#9.最简单的设备驱动层代码&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={28140FE9-6433-42C1-AF3E-BC4095AA19FA}&object-id={4B9976B7-5A6B-0AAC-2C5B-FA7A358559F5}&5B&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 5 input_free_device()函数来释放那些尚未注册的设备
[“9.最简单的设备驱动层代码”页上的图片](onenote:#9.最简单的设备驱动层代码&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={28140FE9-6433-42C1-AF3E-BC4095AA19FA}&object-id={18D84A2D-7075-0129-0E3F-30E957829F57}&1C&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)

### 6 代码编写及其现象
[“9.最简单的设备驱动层代码”页上的图片](onenote:#9.最简单的设备驱动层代码&section-id={2C8F9F87-D48A-4119-B874-6661EE14F4AB}&page-id={28140FE9-6433-42C1-AF3E-BC4095AA19FA}&object-id={18D84A2D-7075-0129-0E3F-30E957829F57}&27&base-path=https://d.docs.live.net/52d4b76bb0ffcf51/Documents/\(RK3568\)Linux驱动开发/第十三期_输入子系统.one)





## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、




# 三、

## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 

### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



# 四、

## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 

### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



# 五、

## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 

### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



# 六、

## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 

### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



## 
### 1 


### 2 


### 3 

### 4 

### 5、


### 6、


### 7、


### 8、



